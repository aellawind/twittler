<!DOCTYPE html>
<html>
  <head>
    <link rel="stylesheet" type="text/css" href="twittler.css">
    <script src="jquery.js"></script>
    <script src="data_generator.js"></script>
  </head>
  <body>
    <div id="head">
      <h1>Twittler!</h1>
    </div>
    <div id="buttonarea"><button id="allbutton">View All Tweets</button></div>
    <div id="posttweet">
      <textarea id="usertweet" cols="50" rows="2"></textarea><br>
      <button id="submittweet">Twittle!</button>
    </div>
    <div id="tweets"></div>
      <script>

        $(document).ready(function(){

          var current_stream = streams.home;

          // Ask the visitor to provide their name--this is a global variable
          visitor = prompt("Please enter your name", "Visitor");
          streams.users[visitor] = [];

          // REMEMBER TO CHECK FOR WHAT HAPPENS IF NO FORM IS FILLED OUT
          
          // Refreshes tweets
          var refreshTweets = function() {
            var streamlength = current_stream.length - 1;
            $("#tweets").html('');
            for (var index=0; index<streamlength;index++) {
              var tweet = current_stream[index];
              var $tweetuser = $('<span class="tweetuser"></span>');
              var $tweet = $('<div class="tweet"></div>');
              var $tweet_timestamp = $('<div class="timestamp"></div>');
              $tweet.text(tweet.message);
              $tweet_timestamp.text("Created on " + tweet.created_at);
              $tweetuser.text('@' + tweet.user + ": ");
              $tweetuser.attr("id",tweet.user);
              $tweet.prependTo($("#tweets"));
              $tweetuser.prependTo($tweet);
              $tweet_timestamp.appendTo($tweet);
            }
          }

          $("#tweets").on("click", ".tweetuser", function(event) {
            event.preventDefault(); // prevents screen from bubbling up
            var current_user = $(this).closest("span").attr("id");
            current_stream = streams.users[current_user];
            $("#allbutton").css("display", "block");
            refreshTweets();
          });
          
          $("#allbutton").on("click", function() {
            current_stream = streams.home;
            $("#allbutton").hide();
            refreshTweets();
          });

          $("#submittweet").on("click", function(event) {
            var msg = $("#usertweet").val();
            if (msg==null || msg=="") {
              alert("You have not entered anything to twittle!");
              return false;
            } else {
              writeTweet(msg);
              $("#usertweet").val("");
            }
          });

        
          // Refresh the page to see new tweets every 5 seconds
          setInterval(refreshTweets,2000);
        });

      </script>
  </body>
</html>
